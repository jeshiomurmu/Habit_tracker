{% extends "base.html" %}

{% block title %}{{ habit.title }} - HabitFlow{% endblock %}

{% block extra_css %}
<style>
    .habit-header {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .habit-title-section {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 20px;
    }
    
    .habit-title-main {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .habit-icon-large {
        font-size: 48px;
    }
    
    .habit-title-text h1 {
        margin: 0;
        font-size: 32px;
        color: #0f172a;
    }
    
    .habit-category {
        display: inline-block;
        background: #f1f5f9;
        color: #64748b;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        margin-top: 8px;
    }
    
    .streak-display {
        text-align: center;
        padding: 16px;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        border-radius: 12px;
        color: white;
    }
    
    .streak-number {
        font-size: 48px;
        font-weight: 700;
        margin: 0;
    }
    
    .streak-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin: 24px 0;
    }
    
    .stat-box {
        text-align: center;
        padding: 20px;
        background: #f8fafc;
        border-radius: 12px;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #6366f1;
    }
    
    .stat-label {
        font-size: 14px;
        color: #64748b;
        margin-top: 4px;
    }
    
    .checkin-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 20px;
        color: #0f172a;
    }
    
    .checkin-form {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .checkin-input {
        flex: 1;
        min-width: 150px;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        font-family: inherit;
    }
    
    .checkin-input:focus {
        outline: none;
        border-color: #6366f1;
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        white-space: nowrap;
    }
    
    .btn-primary {
        background: #6366f1;
        color: white;
    }
    
    .btn-primary:hover {
        background: #4f46e5;
        transform: translateY(-2px);
    }
    
    .btn-danger {
        background: #ef4444;
        color: white;
    }
    
    .btn-danger:hover {
        background: #dc2626;
    }
    
    .btn-secondary {
        background: #f1f5f9;
        color: #0f172a;
    }
    
    .btn-secondary:hover {
        background: #e2e8f0;
    }
    
    .checkin-history {
        margin-top: 24px;
    }
    
    .checkin-item {
        padding: 16px;
        background: #f8fafc;
        border-radius: 10px;
        margin-bottom: 12px;
        border-left: 4px solid #6366f1;
    }
    
    .checkin-date {
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 4px;
    }
    
    .checkin-note {
        font-size: 14px;
        color: #64748b;
    }
    
    .checkin-mood {
        font-size: 20px;
        margin-left: 8px;
    }
    
    .actions-section {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        flex-wrap: wrap;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #64748b;
    }
    
    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    @media (max-width: 768px) {
        .habit-title-section {
            flex-direction: column;
            gap: 16px;
        }
        
        .checkin-form {
            flex-direction: column;
        }
        
        .checkin-input {
            width: 100%;
        }
        
        .actions-section {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <!-- Header Section -->
    <div class="habit-header">
        <div class="habit-title-section">
            <div class="habit-title-main">
                <span class="habit-icon-large">{{ habit.icon }}</span>
                <div class="habit-title-text">
                    <h1>{{ habit.title }}</h1>
                    <span class="habit-category">{{ habit.category }}</span>
                </div>
            </div>
            
            <div class="streak-display">
                <div class="streak-number">üî• {{ streak }}</div>
                <div class="streak-label">Day Streak</div>
            </div>
        </div>
        
        {% if habit.description %}
        <p style="color: #64748b; font-size: 16px; margin-top: 16px;">
            {{ habit.description }}
        </p>
        {% endif %}
        
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value">{{ checkins|length }}</div>
                <div class="stat-label">Total Check-ins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ streak }}</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ habit.frequency }}√ó</div>
                <div class="stat-label">Per Day</div>
            </div>
            {% if habit.reminder_time %}
            <div class="stat-box">
                <div class="stat-value">‚è∞</div>
                <div class="stat-label">{{ habit.reminder_time }}</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Check-in Section -->
    <div class="checkin-section">
        <h2 class="section-title">Quick Check-in</h2>
        
        <form id="checkin-form" class="checkin-form">
            <input type="date" 
                   id="checkin-date" 
                   class="checkin-input" 
                   value="{{ today }}"
                   required>
            
            <input type="text" 
                   id="checkin-note" 
                   class="checkin-input" 
                   placeholder="Add a note (optional)..."
                   style="flex: 2;">
            
            <select id="checkin-mood" class="checkin-input">
                <option value="">Mood</option>
                <option value="üòä">üòä Great</option>
                <option value="üòå">üòå Good</option>
                <option value="üòê">üòê Okay</option>
                <option value="üòî">üòî Meh</option>
            </select>
            
            <button type="submit" class="btn btn-primary">‚úì Check In</button>
        </form>
    </div>
    
    <!-- Check-in History -->
    <div class="checkin-section">
        <h2 class="section-title">Check-in History (Last 90 Days)</h2>
        
        {% if checkins %}
        <div class="checkin-history">
            {% for checkin in checkins[:10] %}
            <div class="checkin-item">
                <div class="checkin-date">
                    {{ checkin.check_date }}
                    {% if checkin.mood %}
                    <span class="checkin-mood">{{ checkin.mood }}</span>
                    {% endif %}
                </div>
                {% if checkin.note %}
                <div class="checkin-note">{{ checkin.note }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <p>No check-ins yet. Create your first check-in above!</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Actions -->
    <div class="actions-section">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        <button onclick="editHabit()" class="btn btn-secondary">‚úèÔ∏è Edit Habit</button>
        <button onclick="deleteHabit()" class="btn btn-danger">üóëÔ∏è Delete Habit</button>
    </div>
</div>

<script>
// Store habit ID in a data attribute to avoid Jinja syntax issues
document.addEventListener('DOMContentLoaded', function() {
    var habitIdElement = document.createElement('div');
    habitIdElement.id = 'habit-data';
    habitIdElement.setAttribute('data-habit-id', '{{ habit.id }}');
    habitIdElement.style.display = 'none';
    document.body.appendChild(habitIdElement);
});
</script>
{% endblock %}
<!-- 
{% block extra_js %}
<script>
(function() {
    // Get habit ID from data attribute
    var habitDataEl = document.getElementById('habit-data');
    var habitId = habitDataEl ? habitDataEl.getAttribute('data-habit-id') : null;
    
    if (!habitId) {
        console.error('Habit ID not found');
        return;
    }
    
    var today = new Date().toISOString().split('T')[0];
    
    // Set today's date by default
    var dateInput = document.getElementById('checkin-date');
    if (dateInput && !dateInput.value) {
        dateInput.value = today;
    }
    
    // Handle check-in form submission
    var checkinForm = document.getElementById('checkin-form');
    if (checkinForm) {
        checkinForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var date = document.getElementById('checkin-date').value;
            var note = document.getElementById('checkin-note').value;
            var mood = document.getElementById('checkin-mood').value;
            
            fetch('/habits/' + habitId + '/checkin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    date: date,
                    done: 1,
                    note: note,
                    mood: mood
                })
            })
            .then(function(response) {
                if (response.ok) {
                    alert('‚úì Check-in successful!');
                    location.reload();
                } else {
                    alert('Failed to check in. Please try again.');
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        });
    }
    
    window.editHabit = function() {
        alert('Edit feature coming soon!');
    };
    
    window.deleteHabit = function() {
        if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
            fetch('/habits/' + habitId + '/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(function(response) {
                if (response.ok) {
                    alert('Habit deleted successfully');
                    window.location.href = '/dashboard';
                } else {
                    alert('Failed to delete habit');
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
                alert('An error occurred while deleting the habit');
            });
        }
    };
})();
</script>
{% endblock %} -->

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const habitId = {{ habit.id }};
    const today = new Date().toISOString().split('T')[0];
    
    // Set today's date by default
    const dateInput = document.getElementById('checkin-date');
    if (dateInput && !dateInput.value) {
        dateInput.value = today;
    }
    
    // Handle check-in form submission
    const checkinForm = document.getElementById('checkin-form');
    if (checkinForm) {
        checkinForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const date = document.getElementById('checkin-date').value;
            const note = document.getElementById('checkin-note').value;
            const mood = document.getElementById('checkin-mood').value;
            
            try {
                const response = await fetch('/habits/' + habitId + '/checkin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        date: date,
                        done: 1,
                        note: note,
                        mood: mood
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úì Check-in successful!');
                    location.reload();
                } else {
                    alert('Failed to check in: ' + (data.error || 'Please try again.'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        });
    }
});

// Global functions for buttons
async function editHabit() {
    alert('Edit feature coming soon!');
}

async function deleteHabit() {
    const habitId = {{ habit.id }};
    
    if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
        try {
            const response = await fetch('/habits/' + habitId + '/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Habit deleted successfully');
                window.location.href = '/dashboard';
            } else {
                alert('Failed to delete habit: ' + (data.error || 'Please try again.'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while deleting the habit');
        }
    }
}
</script>
{% endblock %}





<!--======================================================================================== -->





<!-- {% extends "base.html" %}

{% block title %}{{ habit.title }} - HabitFlow{% endblock %}

{% block extra_css %}
<style>
    .habit-header {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .habit-title-section {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 20px;
    }
    
    .habit-title-main {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .habit-icon-large {
        font-size: 48px;
    }
    
    .habit-title-text h1 {
        margin: 0;
        font-size: 32px;
        color: #0f172a;
    }
    
    .habit-category {
        display: inline-block;
        background: #f1f5f9;
        color: #64748b;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        margin-top: 8px;
    }
    
    .streak-display {
        text-align: center;
        padding: 16px;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        border-radius: 12px;
        color: white;
    }
    
    .streak-number {
        font-size: 48px;
        font-weight: 700;
        margin: 0;
    }
    
    .streak-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin: 24px 0;
    }
    
    .stat-box {
        text-align: center;
        padding: 20px;
        background: #f8fafc;
        border-radius: 12px;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #6366f1;
    }
    
    .stat-label {
        font-size: 14px;
        color: #64748b;
        margin-top: 4px;
    }
    
    .checkin-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 20px;
        color: #0f172a;
    }
    
    .checkin-form {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .checkin-input {
        flex: 1;
        min-width: 150px;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        font-family: inherit;
    }
    
    .checkin-input:focus {
        outline: none;
        border-color: #6366f1;
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        white-space: nowrap;
    }
    
    .btn-primary {
        background: #6366f1;
        color: white;
    }
    
    .btn-primary:hover {
        background: #4f46e5;
        transform: translateY(-2px);
    }
    
    .btn-danger {
        background: #ef4444;
        color: white;
    }
    
    .btn-danger:hover {
        background: #dc2626;
    }
    
    .btn-secondary {
        background: #f1f5f9;
        color: #0f172a;
    }
    
    .btn-secondary:hover {
        background: #e2e8f0;
    }
    
    .checkin-history {
        margin-top: 24px;
    }
    
    .checkin-item {
        padding: 16px;
        background: #f8fafc;
        border-radius: 10px;
        margin-bottom: 12px;
        border-left: 4px solid #6366f1;
    }
    
    .checkin-date {
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 4px;
    }
    
    .checkin-note {
        font-size: 14px;
        color: #64748b;
    }
    
    .checkin-mood {
        font-size: 20px;
        margin-left: 8px;
    }
    
    .actions-section {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        flex-wrap: wrap;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #64748b;
    }
    
    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    @media (max-width: 768px) {
        .habit-title-section {
            flex-direction: column;
            gap: 16px;
        }
        
        .checkin-form {
            flex-direction: column;
        }
        
        .checkin-input {
            width: 100%;
        }
        
        .actions-section {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <!-- Header Section -->
    <div class="habit-header">
        <div class="habit-title-section">
            <div class="habit-title-main">
                <span class="habit-icon-large">{{ habit.icon }}</span>
                <div class="habit-title-text">
                    <h1>{{ habit.title }}</h1>
                    <span class="habit-category">{{ habit.category }}</span>
                </div>
            </div>
            
            <div class="streak-display">
                <div class="streak-number">üî• {{ streak }}</div>
                <div class="streak-label">Day Streak</div>
            </div>
        </div>
        
        {% if habit.description %}
        <p style="color: #64748b; font-size: 16px; margin-top: 16px;">
            {{ habit.description }}
        </p>
        {% endif %}
        
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value">{{ checkins|length }}</div>
                <div class="stat-label">Total Check-ins</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ streak }}</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">{{ habit.frequency }}√ó</div>
                <div class="stat-label">Per Day</div>
            </div>
            {% if habit.reminder_time %}
            <div class="stat-box">
                <div class="stat-value">‚è∞</div>
                <div class="stat-label">{{ habit.reminder_time }}</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Check-in Section -->
    <div class="checkin-section">
        <h2 class="section-title">Quick Check-in</h2>
        
        <form id="checkin-form" class="checkin-form">
            <input type="date" 
                   id="checkin-date" 
                   class="checkin-input" 
                   value="{{ today }}"
                   required>
            
            <input type="text" 
                   id="checkin-note" 
                   class="checkin-input" 
                   placeholder="Add a note (optional)..."
                   style="flex: 2;">
            
            <select id="checkin-mood" class="checkin-input">
                <option value="">Mood</option>
                <option value="üòä">üòä Great</option>
                <option value="üòå">üòå Good</option>
                <option value="üòê">üòê Okay</option>
                <option value="üòî">üòî Meh</option>
            </select>
            
            <button type="submit" class="btn btn-primary">‚úì Check In</button>
        </form>
    </div>
    
    <!-- Check-in History -->
    <div class="checkin-section">
        <h2 class="section-title">Check-in History (Last 90 Days)</h2>
        
        {% if checkins %}
        <div class="checkin-history">
            {% for checkin in checkins[:10] %}
            <div class="checkin-item">
                <div class="checkin-date">
                    {{ checkin.check_date }}
                    {% if checkin.mood %}
                    <span class="checkin-mood">{{ checkin.mood }}</span>
                    {% endif %}
                </div>
                {% if checkin.note %}
                <div class="checkin-note">{{ checkin.note }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <p>No check-ins yet. Create your first check-in above!</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Actions -->
    <div class="actions-section">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        <button onclick="editHabit()" class="btn btn-secondary">‚úèÔ∏è Edit Habit</button>
        <button onclick="deleteHabit()" class="btn btn-danger">üóëÔ∏è Delete Habit</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const habitId = {{ habit.id }};
    const today = new Date().toISOString().split('T')[0];
    
    // Set today's date by default
    const dateInput = document.getElementById('checkin-date');
    if (dateInput && !dateInput.value) {
        dateInput.value = today;
    }
    
    // Handle check-in form submission
    const checkinForm = document.getElementById('checkin-form');
    if (checkinForm) {
        checkinForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const date = document.getElementById('checkin-date').value;
            const note = document.getElementById('checkin-note').value;
            const mood = document.getElementById('checkin-mood').value;
            
            try {
                const response = await fetch('/habits/' + habitId + '/checkin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        date: date,
                        done: 1,
                        note: note,
                        mood: mood
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úì Check-in successful!');
                    location.reload();
                } else {
                    alert('Failed to check in: ' + (data.error || 'Please try again.'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        });
    }
});

// Global functions for buttons
async function editHabit() {
    alert('Edit feature coming soon!');
}

async function deleteHabit() {
    const habitId = {{ habit.id }};
    
    if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
        try {
            const response = await fetch('/habits/' + habitId + '/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Habit deleted successfully');
                window.location.href = '/dashboard';
            } else {
                alert('Failed to delete habit: ' + (data.error || 'Please try again.'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while deleting the habit');
        }
    }
}
</script>
{% endblock %} -->